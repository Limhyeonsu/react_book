# 17.리덕스를 사용하여 리액트 애플리케이션 상태 관리하기
리액트 애플리케이션에서 리덕스 사용시 상태 업데이트에 관한 로직을 모듈로 따로 분리하여 컴포넌트 파일과 별개로 관리할 수 있어 유지보수 하는데 도움이 된다.   
또한 여러 컴포넌트에서 동일한 상태를 공유해야 할 때 매우 유용하며 실제 업데이트가 필요한 컴포넌트만 리렌더링되도록 쉽게 최적화해 줄 수도 있다.

리액트 애플리케이션에서 리덕스를 사용할 때는 store 인스턴스를 직접 사용하기보다는 주로 `react-redux라는 라이브러리` 에서 제공하는 유틸 함수와 컴포넌트를 사용하여 리덕스 관련 작업을 처리한다.

## 17.1 작업 환경 설정
`yarn add redux react-redux`

## 17.2 UI 준비하기
리액트에서 리덕스 사용시 많이 사용하는 패턴
* 프레젠테이셔널 컴포넌트 : 상태관리가 이루어지지 않고, props를 받아 와서 화면에 UI를 보여 주기만 하는 컴포넌트를 말함
* 컨테이너 컴포넌트 : 리덕스와 연동되어 있는 컴포넌트로, 리덕스로부터 상태를 받아 오기도 하고 리덕스 스토어에 액션을 디스패치 하기도 한다.

__프레젠테이셔널 컴포넌트 예시__
```javascript
const Counter = ({ number, onIncrease, onDecrease }) => {
  return (
    <div>
      <h1>{number}</h1>
      <div>
        <button onClick={onIncrease}>+1</button>
        <button onClick={onDecrease}>-1</button>
      </div>
    </div>
  );
};
export default Counter;


const TodoItem = ({ todo, onToggle, onRemove }) => {
  return (
    <div>
      <input type="checkbox" />
      <span>예제 텍스트</span>
      <button>삭제</button>
    </div>
  );
};

const Todos = ({
                 input,
                 todos,
                 onChangeInput,
                 onInsert,
                 onToggle,
                 onRemove,
               }) => {
  const onSubmit = (e) => {
    e.preventDefault();
  };
  return (
    <div>
      <form onSubmit={onSubmit}>
        <input />
        <button type="submit">등록</button>
      </form>
      <div>
        <TodoItem />
        <TodoItem />
        <TodoItem />
        <TodoItem />
        <TodoItem />
      </div>
    </div>
  );
};

export default Todos;

import Counter from './components/Counter';
import Todos from './components/Todos';
const App = () => {
  return (
    <div>
      <Counter number={0} />
      <hr />
      <Todos />
    </div>
  );
};
export default App;
```

## 17.3 리덕스 관련 코드 작성하기
리덕스를 사용할 때 액션 타입, 액션 생성 함수, 리듀서 코드를 작성해야 하는데 프로젝트 구조를 
1. 일반적인 구조 방식 : action, constants, reducer라는 세 개의 디렉터리를 만들고 그 안에 기능별로 파일을 하나씩 만드는 방식
2. Ducks 패턴 : 기능별로 파일 하나에 몰아서 다 작성하는 방식 (책에서는 Ducks 패턴 사용)

[export / export default의 차이점]
```javascript
//export는 여러개 내보낼 수 있다.
export const a = () => {};
export const b = () => {};
//import시에는 {} 괄호를 사용
import {a, b} from './abc'


//export default는 단 한개만 내보낼 수 있다.
export default abc;
import abc from './abc';

//import 함께 사용
import abc, {a, b} from './abc';
```

```javascript
//1. 액션 타입 정의 : 액션 타입은 대문자로 정의, 문자열 내용은 '모듈이름/액션이름' 형태로 작성
const INCREASE = 'counter/INCREASE';
const DECREASE = 'counter/DECREASE';

//2. 액션 생성 함수 : 앞 부분에 export 키워드가 들어감
export const increase = () => ({ type: INCREASE });
export const decrease = () => ({ type: DECREASE });

//3. 초기 상태 및 리듀서 함수 만들기
const initialState = {
  number: 0,
};

function counter(state = initialState, action) {
  switch (action.type) {
    case INCREASE:
      return {
        number: state.number + 1,
      };
    case DECREASE:
      return {
        number: state.number - 1,
      };
    default:
      return state;
  }
}
export default counter;
```
```javascript
//액션 타입 정의
const CHANGE_INPUT = 'todos/CHANGE_INPUT'; //인풋값 변경
const INSERT = 'todos/INSERT'; //새로운 todo를 등록
const TOGGLE = 'todos/TOGGLE'; //todo를 체크/ 체크해제
const REMOVE = 'todos/REMOVE'; //todo 제거

//액션 생성 함수
export const changeInput = (input) => ({
  type: CHANGE_INPUT,
  input,
});

let id = 3;
export const insert = (text) => ({
  type: INSERT,
  todo: {
    id: id++,
    text,
    done: false,
  },
});

export const toggle = (id) => ({
  type: TOGGLE,
  id,
});

export const remove = (id) => ({
  type: REMOVE,
  id,
});

//초기 상태 및 리듀서 함수
const initialState = {
  input: '',
  todos: [
    {
      id: 1,
      text: '리덕스 기초 배우기',
      done: true,
    },
    {
      id: 2,
      text: '리액트와 리덕스 사용하기',
      done: false,
    },
  ],
};

function todos(state = initialState, action) {
  switch (action.type) {
    case CHANGE_INPUT:
      return {
        ...state,
        input: action.input,
      };
    case INSERT:
      return {
        ...state,
        todos: state.todos.concat(action.todo),
      };
    case TOGGLE:
      return {
        ...state,
        todos: state.todos.map((todo) =>
          todo.id === action.id ? { ...todo, done: !todo.done } : todo,
        ),
      };
    case REMOVE:
      return {
        ...state,
        todos: state.todos.fillter((todo) => todo.id !== action.id),
      };
    default:
      return state;
  }
}

export default todos;
```
```javascript
// src/modules/index.js
import { combineReducers } from 'redux';
import counter from './counter';
import todos from './todos';

//여러개의 리듀서를 하나로 합칠때 combineReducers
const rootReducer = combineReducers({
  counter,
  todos,
});
export default rootReducer;
```

## 17.4 리액트 애플리케이션에 리덕스 적용하기
```javascript
//src/index.js
import ReactDOM from 'react-dom';
import { createStore } from 'redux';
import './index.css';
import App from './App';
import rootReducer from './modules';
import { Provider } from 'react-redux';

//1. 스토어 생성
const store = createStore(rootReducer);

ReactDOM.render(
  // 2.스토어를 사용할 수 있도록 <App>을 <Provider>로 감싸준다.(이때 store를 props로 전달해야함)
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById('root'),
);
```
__Redux DevTools의 설치 및 적용__ : 리덕스 개발자 도구로 크롬 확장 프로그램을 설치하여 사용한다.
```javascript
//설치하고 나면 store 생성시 다음과 같이 적용할 수 있다.
const store = createStore(
  rootReducer,
  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
);
```
하지만 패키지 설치시 코드가 훨씬 깔끔해진다. `yarn add redux-devtools-extension`
```javascript
import { composeWithDevTools } from 'redux-devtools-extension';

const store = createStore(rootReducer, composeWithDevTools());
```